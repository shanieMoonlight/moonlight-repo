<mat-icon
  id="butt-icon"
  [matTooltip]="_toolTip()"
  [matMenuTriggerFor]="menu"
  aria-label="Change Theme Menu">
  palette
</mat-icon>

<mat-menu #menu="matMenu">
  @for (option of _options; track option) {
    <button
      mat-menu-item
      [class.selected]="option === _selectedOption()"
      (click)="_changeThemeClick$.next(option)">
      <mat-icon
        role="img"
        class="colors-icon"
        svgicon="theme-example"
        aria-hidden="true">
        <ng-container 
          [ngTemplateOutlet]="svgThemeDisplay" 
          [ngTemplateOutletContext]="{option:option}"/>     
      </mat-icon>
      <span>{{ option.label }}</span>
    </button>
  }
</mat-menu>

<!-- ---------------------------------------------------------------------- -->
<!-- 
<ng-template #svgThemeDisplay0 let-option="option">

  <svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    width="100%"
    height="100%"
    viewBox="0 0 80 80"
    fit=""
    preserveAspectRatio="xMidYMid meet"
    focusable="false">
  <defs>
    <path
      d="M77.87 0C79.05 0 80 .95 80 2.13v75.74c0 1.17-.95 2.13-2.13 2.13H2.13C.96 80 0 79.04 0 77.87V2.13C0 .95.96 0 2.13 0h75.74z"
      id="a">
    </path>
    <path
      d="M54 40c3.32 0 6 2.69 6 6 0 1.2 0-1.2 0 0 0 3.31-2.68 6-6 6H26c-3.31 0-6-2.69-6-6 0-1.2 0 1.2 0 0 0-3.31 2.69-6 6-6h28z"
      id="b">
    </path>
    <path d="M0 0h80v17.24H0V0z" id="c"></path>
  </defs>
  <use xlink:href="#a" [attr.fill]="option?.primaryColor"></use>
  <use xlink:href="#b" [attr.fill]="option?.secondaryColor"></use>
  <use
    xlink:href="#c"
    [attr.fill]="option?.isDarkMode ? 'black' : 'white'"></use>
</svg>

</ng-template> -->

<!-- ---------------------------------------------------------------------- -->



<ng-template #svgThemeDisplay let-option="option">
  <svg
    xmlns="http://www.w3.org/2000/svg"
    xmlns:xlink="http://www.w3.org/1999/xlink"
    width="100%"
    height="100%"
    viewBox="0 0 80 80"
    fit=""
    preserveAspectRatio="xMidYMid meet"
    focusable="false">

    <title>Theme Preview: {{option?.label}}</title>

    <defs>
      <!-- Base background (Dark/Light Mode Indicator) - slightly rounded -->
      <rect id="base" x="0" y="0" width="80" height="80" rx="8" ry="8"></rect>

      <!-- Primary Color Layer - smaller rounded rectangle, offset -->
      <rect id="primary-layer" x="5" y="10" width="70" height="60" rx="6" ry="6"></rect>

      <!-- Secondary Color Accent - circle, offset -->
      <!-- <circle id="secondary-accent" cx="60" cy="60" r="15"></circle> -->
      <rect id="secondary-accent" x="45" y="35" width="32.5" height="35" rx="6" ry="6"></rect>

      <!-- Tertiary Color Accent - small rectangle/line, offset -->
      <rect id="tertiary-accent" x="15" y="15" width="30" height="8" rx="4" ry="4"></rect>
    </defs>

    <!-- Render Order: Base first, then layers on top -->

    <!-- 1. Base Background (Light/Dark) -->
    <use xlink:href="#base" [attr.fill]="option?.isDarkMode ? '#303030' : '#FFFFFF'"></use>

    <!-- 2. Primary Layer -->
    <use xlink:href="#primary-layer" [attr.fill]="option?.primaryColor"></use>

    <!-- 3. Secondary Accent -->
    <use xlink:href="#secondary-accent" [attr.fill]="option?.secondaryColor"></use>

    <!-- 4. Tertiary Accent (Optional) -->
    @if (option?.tertiaryColor) {
      <use xlink:href="#tertiary-accent" [attr.fill]="option?.tertiaryColor"></use>
    }
  </svg>
</ng-template>