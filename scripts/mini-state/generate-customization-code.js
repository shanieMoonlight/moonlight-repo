// filepath: c:\Users\Shaneyboy\VsCode\moonlight-repo\scripts\generate-customization-code.js
const fs = require('fs');
const path = require('path');

// Define paths relative to the script location or workspace root
const workspaceRoot = path.join(__dirname, '..'); // Assumes script is in workspace_root/scripts
const tsFilePath = path.join(workspaceRoot, 'apps/sb-mat-thm-demo/src/app/sections/main/features/customization/customization.component.ts');
const htmlFilePath = path.join(workspaceRoot, 'apps/sb-mat-thm-demo/src/app/sections/main/features/customization/customization.component.html');
const outputDir = path.join(workspaceRoot, 'apps/sb-mat-thm-demo/src/app/sections/main/features/customization/generated'); // Output directory
const outputFilePath = path.join(outputDir, 'customization-code.ts'); // Output file

try {
    // Ensure output directory exists
    if (!fs.existsSync(outputDir)) {
        fs.mkdirSync(outputDir, { recursive: true });
        console.log(`Created directory: ${outputDir}`);
    }

    // Read file contents
    const tsContent = fs.readFileSync(tsFilePath, 'utf8');
    const htmlContent = fs.readFileSync(htmlFilePath, 'utf8');

    // Escape backticks and backslashes in the content for template literals
    const escapeTemplateLiteral = (str) => str.replace(/\\/g, '\\\\').replace(/`/g, '\\`').replace(/\$/g, '\\$');

    const tsContentEscaped = escapeTemplateLiteral(tsContent);
    const htmlContentEscaped = escapeTemplateLiteral(htmlContent);
    

    // Create the TypeScript file content
       // Create the TypeScript file content - USE THE ESCAPED VARIABLES HERE
       const fileContent = `// IMPORTANT: This file is generated by scripts/generate-customization-code.js
       // Do not edit this file manually, as your changes will be overwritten.
       
       export const CUSTOMIZATION_COMPONENT_TS_CODE = \`${tsContentEscaped}\`;
       
       export const CUSTOMIZATION_COMPONENT_HTML_CODE = \`${htmlContentEscaped}\`;
       `; // <-- Added the variables and closing backtick

       console.log(`Generated TypeScript file content:\n${fileContent}`); // Log the generated content
       

    // Write the new file
    fs.writeFileSync(outputFilePath, fileContent, 'utf8');
    console.log(`Successfully generated ${outputFilePath}`);

} catch (error) {
    console.error('Error generating customization code strings:', error);
    process.exit(1); // Exit with error code
};


